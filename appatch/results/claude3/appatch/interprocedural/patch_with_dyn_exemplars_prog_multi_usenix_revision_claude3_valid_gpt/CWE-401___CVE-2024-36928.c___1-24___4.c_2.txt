diff
9 		qeth_free_qdio_queues(card);
+ 	bool allocation_success = true;
+ 	for (int i = 0; i < max; i++) {
+ 		card->qdio.out_qs[i] = qeth_alloc_output_queue();
+ 		if (!card->qdio.out_qs[i]) {
+ 			allocation_success = false;
+ 			break;
+ 		}
+ 	}
+ 	if (allocation_success) {
14 		card->qdio.no_out_queues = max;
+ 	} else {
+ 		qeth_free_qdio_queues(card);
+ 		dev_err(&card->gdev->dev, "Failed to allocate output queues\n");
+ 	}
