c
static size_t safe_strnlen(const char* s, size_t maxlen)
{
    return s ? strnlen(s, maxlen) : 0;
}

SSIZE_T ConvertUtf8NToWChar(const char* str, size_t len, WCHAR* wstr, size_t wlen)
{
    size_t ilen = safe_strnlen(str, len);
    // ... rest of the function
}
