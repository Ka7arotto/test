c
#define SAFE_STRNLEN(s, n) ((s) ? strnlen((s), (n)) : 0)

SSIZE_T ConvertUtf8NToWChar(const char* str, size_t len, WCHAR* wstr, size_t wlen)
{
    size_t ilen = SAFE_STRNLEN(str, len);
    // ... rest of the function
}
