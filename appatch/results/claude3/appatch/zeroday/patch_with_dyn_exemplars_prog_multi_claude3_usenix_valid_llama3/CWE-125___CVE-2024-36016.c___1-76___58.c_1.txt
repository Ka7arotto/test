
< 		gsm->len |= len << 7;
< 		if (gsm->len > gsm->mru) {
---
> 		gsm->len |= len << 7;
> 		gsm->len = MIN(gsm->len, sizeof(gsm->buf));
> 		if (gsm->len > gsm->mru) {
