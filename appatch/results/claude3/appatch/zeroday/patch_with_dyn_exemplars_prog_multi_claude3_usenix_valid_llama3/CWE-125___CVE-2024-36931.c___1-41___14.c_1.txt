
< 	buffer = vmemdup_user(buf, lbuf);
---
> 	buffer = memdup_user(buf, lbuf);
> 	if (IS_ERR(buffer))
> 		return PTR_ERR(buffer);
