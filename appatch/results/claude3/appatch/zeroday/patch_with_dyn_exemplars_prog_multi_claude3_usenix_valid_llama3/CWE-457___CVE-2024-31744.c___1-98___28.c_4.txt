c
// Implement a custom allocator that delays freeing
void *delayed_alloc(size_t size);
void delayed_free(void *ptr);

// Modify jpc_streamlist_remove to use delayed_free
jpc_stream_t *jpc_streamlist_remove_delayed(jpc_streamlist_t *list, int idx) {
    jpc_stream_t *stream = jpc_streamlist_remove(list, idx);
    if (stream) {
        // Replace normal free with delayed_free in the implementation
    }
    return stream;
}

// In the main function:
if (!(tile->pkthdrstream = jpc_streamlist_remove_delayed(dec->pkthdrstreams, 0))) {
    return -1;
}
