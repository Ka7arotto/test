
+ #define MAX_BUFFER_SIZE 4096
< 	buffer = vmemdup_user(buf, lbuf);
---
> 	if (lbuf > MAX_BUFFER_SIZE)
> 		return -EINVAL;
> 	buffer = vmemdup_user(buf, lbuf);
