
< 	kern_buf = memdup_user(buf, nbytes);
---
+ 	kern_buf = strndup_user(buf, min_t(size_t, nbytes, PAGE_SIZE));
+ 	if (IS_ERR(kern_buf))
+ 		return PTR_ERR(kern_buf);
