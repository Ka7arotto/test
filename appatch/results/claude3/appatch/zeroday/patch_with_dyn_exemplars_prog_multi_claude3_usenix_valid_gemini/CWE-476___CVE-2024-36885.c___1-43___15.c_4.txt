
<     fw->img = kmemdup(src, fw->len, GFP_KERNEL);
<     len = ALIGN(fw->len, PAGE_SIZE);
---
>     fw->img = kmemdup(src, fw->len, GFP_KERNEL);
>     if (!fw->img) {
>         dev_err(fw->device->dev, "Failed to allocate memory for firmware %s\n", fw->name);
>         return -ENOMEM;
>     }
>     len = ALIGN(fw->len, PAGE_SIZE);
