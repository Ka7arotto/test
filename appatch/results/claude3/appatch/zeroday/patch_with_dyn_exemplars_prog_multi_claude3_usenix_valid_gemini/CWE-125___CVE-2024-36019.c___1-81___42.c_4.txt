
< 			upper = kmemdup(&entry[max + 1],
---
> 			upper = kmemdup(&entry[min(max + 1, array_size - 1)],
