
+ #define MAX_BUFFER_SIZE 1024
< 	kern_buf = memdup_user(buf, nbytes);
---
+ 	if (nbytes > MAX_BUFFER_SIZE)
+ 		return -EINVAL;
+ 	kern_buf = memdup_user(buf, nbytes);
