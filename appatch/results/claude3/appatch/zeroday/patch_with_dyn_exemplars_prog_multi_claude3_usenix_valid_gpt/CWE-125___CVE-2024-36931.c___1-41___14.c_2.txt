
< 	buffer = vmemdup_user(buf, lbuf);
---
> 	if (lbuf == 0 || lbuf > PAGE_SIZE)
> 		return -EINVAL;
> 	buffer = vmemdup_user(buf, lbuf);
