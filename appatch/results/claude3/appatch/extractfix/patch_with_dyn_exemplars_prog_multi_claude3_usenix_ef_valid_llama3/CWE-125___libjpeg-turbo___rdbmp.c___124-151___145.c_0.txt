
<     *outptr++ = colormap[0][t]; /* colormap[x] has size cmaplen */
---
>     if (t < source->cmaplen) {
>         *outptr++ = colormap[0][t];
>     } else {
>         *outptr++ = 0; // or some default value
>     }
