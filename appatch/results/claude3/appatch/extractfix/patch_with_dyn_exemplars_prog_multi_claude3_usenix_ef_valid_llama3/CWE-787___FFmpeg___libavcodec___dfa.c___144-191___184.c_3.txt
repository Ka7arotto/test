
<     if (frame_end - frame < width + 3)
---
>     if (frame_end - frame < width + 4)
>         return -1;
>     if (safe_write(frame, frame_end, /* data */, 4) < 0)
>         return -1;
>     frame += 4;
