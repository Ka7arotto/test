
< 		rows[nrows++] = br + bpr*sy;
---
> 		rows[nrows % MAX_ROWS] = br + bpr*sy;
> 		nrows++;
> 		if (nrows >= MAX_ROWS) {
> 			// Log warning: buffer wrapped around
> 			fprintf(stderr, "Warning: Buffer wrapped around at row %d\n", nrows);
> 		}
