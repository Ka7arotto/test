
<     *outptr++ = colormap[0][t]; /* colormap[x] has size cmaplen */
---
>     *outptr++ = (t < source->cmaplen) ? colormap[0][t] : 0; // 0 or another default value
