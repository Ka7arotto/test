
<     t = GETJSAMPLE(*inptr++);
<     *outptr++ = colormap[0][t]; /* colormap[x] has size cmaplen */
---
>     t = GETJSAMPLE(*inptr++);
>     t = (t < source->cmaplen) ? t : (source->cmaplen - 1);
>     *outptr++ = colormap[0][t];
