
<                         for (; cc < tf_bytesperrow; cc += samplesperpixel) {
---
>                         for (; cc < tf_bytesperrow && cp < tf_buf + tf_bytesperrow; cc += samplesperpixel) {
