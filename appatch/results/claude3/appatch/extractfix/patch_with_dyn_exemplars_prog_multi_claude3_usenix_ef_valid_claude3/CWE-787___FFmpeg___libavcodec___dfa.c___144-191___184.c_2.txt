
<     if (frame_end - frame < width + 3)
---
>     if (frame_end - frame < width + 4)
>         return -1;
>     if (frame + 3 < frame_end) {
>         frame[0] = frame[1] = /* ... */;
>         frame += 2;
>         frame[0] = frame[1] = /* ... */;
>         frame += 2;
>     } else {
>         return -1;
>     }
