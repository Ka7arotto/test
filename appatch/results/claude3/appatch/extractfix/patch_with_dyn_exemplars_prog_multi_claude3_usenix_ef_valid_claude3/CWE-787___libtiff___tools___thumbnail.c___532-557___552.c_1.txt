
< 		rows[nrows++] = br + bpr*sy;
---
> 		if (nrows < sizeof(rows)/sizeof(rows[0])) {
> 			rows[nrows++] = br + bpr*sy;
> 		} else {
> 			// Handle error: array full
> 			break;
> 		}
