1 static int regcache_maple_drop(struct regmap *map, unsigned int min,
2 			       unsigned int max)
4 	struct maple_tree *mt = map->cache;
5 	MA_STATE(mas, mt, min, max);
6 	unsigned long *entry, *lower, *upper;
7 	unsigned long lower_index, lower_last;
8 	unsigned long upper_index, upper_last;
9 	int ret;
11 	lower = NULL;
12 	upper = NULL;
14 	mas_lock(&mas);
16 	mas_for_each(&mas, entry, max) {
22 		mas_unlock(&mas);
25 		if (mas.index < min) {
26 			lower_index = mas.index;
27 			lower_last = min -1;
29 			lower = kmemdup(entry, ((min - mas.index) *
30 						sizeof(unsigned long)),
31 					map->alloc_flags);
32 			if (!lower) {
33 				ret = -ENOMEM;
34 				goto out_unlocked;
38 		if (mas.last > max) {
39 			upper_index = max + 1;
40 			upper_last = mas.last;
42 			upper = kmemdup(&entry[max + 1],
43 					((mas.last - max) *
44 					 sizeof(unsigned long)),
45 					map->alloc_flags);
46 			if (!upper) {
47 				ret = -ENOMEM;
48 				goto out_unlocked;
52 		kfree(entry);
53 		mas_lock(&mas);