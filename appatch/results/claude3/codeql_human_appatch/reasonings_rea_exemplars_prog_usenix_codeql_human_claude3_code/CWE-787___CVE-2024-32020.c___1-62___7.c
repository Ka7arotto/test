1 static void copy_or_link_directory(struct strbuf *src, struct strbuf *dest,
2 				   const char *src_repo)
4 	int src_len, dest_len;
5 	struct dir_iterator *iter;
6 	int iter_status;
7 	struct strbuf realpath = STRBUF_INIT;
9 	mkdir_if_missing(dest->buf, 0777);
11 	iter = dir_iterator_begin(src->buf, DIR_ITERATOR_PEDANTIC);
13 	if (!iter)
14 		die_errno(_("failed to start iterator over '%s'"), src->buf);
16 	strbuf_addch(src, '/');
17 	src_len = src->len;
18 	strbuf_addch(dest, '/');
19 	dest_len = dest->len;
21 	while ((iter_status = dir_iterator_advance(iter)) == ITER_OK) {
22 		strbuf_setlen(src, src_len);
23 		strbuf_addstr(src, iter->relative_path);
24 		strbuf_setlen(dest, dest_len);
25 		strbuf_addstr(dest, iter->relative_path);