c
+ static void safe_strbuf_addstr(struct strbuf *sb, const char *str)
+ {
+     size_t len = strlen(str);
+     if (sb->alloc - sb->len <= len) {
+         strbuf_grow(sb, len + 1);
+     }
+     strbuf_addstr(sb, str);
+ }

- strbuf_addstr(src, iter->relative_path);
+ safe_strbuf_addstr(src, iter->relative_path);
