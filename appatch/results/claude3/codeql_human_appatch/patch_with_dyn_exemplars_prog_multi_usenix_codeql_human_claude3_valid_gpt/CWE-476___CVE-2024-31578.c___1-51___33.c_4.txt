
int av_hwframe_ctx_init(AVBufferRef *ref)
{
+    if (!ref || !ref->data)
+        return AVERROR(EINVAL);
     AVHWFramesContext *ctx = (AVHWFramesContext*)ref->data;
     // ... rest of the function
