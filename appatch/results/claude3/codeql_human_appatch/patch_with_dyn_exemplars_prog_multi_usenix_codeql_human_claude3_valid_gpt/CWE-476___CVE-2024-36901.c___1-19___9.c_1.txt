
<     struct inet6_dev *idev = ip6_dst_idev(skb_dst(skb));
< 
<     skb->protocol = htons(ETH_P_IPV6);
---
>     struct inet6_dev *idev = ip6_dst_idev(skb_dst(skb));
>     if (!idev) {
>         kfree_skb(skb);
>         return -EINVAL;
>     }
> 
>     skb->protocol = htons(ETH_P_IPV6);
