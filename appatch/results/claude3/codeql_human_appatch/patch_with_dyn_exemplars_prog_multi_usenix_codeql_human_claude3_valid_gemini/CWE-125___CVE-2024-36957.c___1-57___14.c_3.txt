
<   cmd_buf = memdup_user(buffer, count + 1);
<   if (IS_ERR(cmd_buf))
<       return -ENOMEM;
<
<   cmd_buf[count] = '\0';
---
>   cmd_buf = strndup_user(buffer, count);
>   if (IS_ERR(cmd_buf))
>       return -ENOMEM;
