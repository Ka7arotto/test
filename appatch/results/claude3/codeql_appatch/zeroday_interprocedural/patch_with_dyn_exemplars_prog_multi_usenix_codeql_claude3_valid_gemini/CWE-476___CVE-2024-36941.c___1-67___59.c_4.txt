diff
+ static void update_coalesce(struct cfg80211_registered_device *rdev,
+ 			    struct cfg80211_coalesce *new_coalesce)
+ {
+ 	struct cfg80211_coalesce *old_coalesce = rdev->coalesce;
+ 	rdev->coalesce = new_coalesce;
+ 	if (old_coalesce)
+ 		cfg80211_rdev_free_coalesce(old_coalesce);
+ }
+
  // In the main function:
- 	cfg80211_rdev_free_coalesce(rdev);
- 	rdev->coalesce = n_coalesce;
+ 	update_coalesce(rdev, n_coalesce);
