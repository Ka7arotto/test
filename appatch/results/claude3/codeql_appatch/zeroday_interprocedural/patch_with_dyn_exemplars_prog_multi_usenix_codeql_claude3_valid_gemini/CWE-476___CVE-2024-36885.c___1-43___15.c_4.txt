
< 		len = ALIGN(fw->len, PAGE_SIZE);
< 		fw->img = kmalloc(len, GFP_KERNEL);
< 		if (!fw->img)
< 			return -ENOMEM;
< 		memcpy(fw->img, src, fw->len);
---
> 		fw->img = kmemdup(src, fw->len, GFP_KERNEL);
> 		if (!fw->img)
> 			return -ENOMEM;
