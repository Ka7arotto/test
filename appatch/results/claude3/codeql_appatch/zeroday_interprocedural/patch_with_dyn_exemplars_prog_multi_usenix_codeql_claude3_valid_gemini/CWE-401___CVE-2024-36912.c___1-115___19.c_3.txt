diff
 	ret = set_memory_decrypted((unsigned long)kbuffer,
 				   PFN_UP(size));
 	if (ret) {
 		dev_warn(&channel->device_obj->device,
 			 "Failed to set host visibility for new GPADL %d.\n",
 			 ret);
 		return ret;
 	}
+	if (!msginfo)
+		return -ENOMEM;
 
 	init_completion(&msginfo->waitevent);
