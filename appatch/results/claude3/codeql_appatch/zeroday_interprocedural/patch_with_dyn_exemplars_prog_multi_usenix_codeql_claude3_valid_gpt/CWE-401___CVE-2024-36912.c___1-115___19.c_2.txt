diff
 	ret = create_gpadl_header(type, kbuffer, size, send_offset, &msginfo);
-	if (ret)
+	if (ret || !msginfo)
 		return ret ? ret : -ENOMEM;
 
 	ret = set_memory_decrypted((unsigned long)kbuffer,
 				   PFN_UP(size));
