1 static int CFReserve_RedisCommand(RedisModuleCtx *ctx, RedisModuleString **argv, int argc) {
2     RedisModule_AutoMemory(ctx);
4     if (argc < 3 || (argc % 2) == 0) {
5         return RedisModule_WrongArity(ctx);
8     long long capacity;
9     if (RedisModule_StringToLongLong(argv[2], &capacity)) {
10         return RedisModule_ReplyWithError(ctx, "Bad capacity");
13     long long maxIterations = CF_MAX_ITERATIONS;
14     int mi_loc = RMUtil_ArgIndex("MAXITERATIONS", argv, argc);
15     if (mi_loc != -1) {
16         if (RedisModule_StringToLongLong(argv[mi_loc + 1], &maxIterations) != REDISMODULE_OK) {
17             return RedisModule_ReplyWithError(ctx, "Couldn't parse MAXITERATIONS");
19             return RedisModule_ReplyWithError(
20                 ctx, "MAXITERATIONS parameter needs to be a positive integer");
24     long long bucketSize = CF_DEFAULT_BUCKETSIZE;
25     int bs_loc = RMUtil_ArgIndex("BUCKETSIZE", argv, argc);
26     if (bs_loc != -1) {
27         if (RedisModule_StringToLongLong(argv[bs_loc + 1], &bucketSize) != REDISMODULE_OK) {
28             return RedisModule_ReplyWithError(ctx, "Couldn't parse BUCKETSIZE");
30             return RedisModule_ReplyWithError(
31                 ctx, "BUCKETSIZE parameter needs to be a positive integer");
35     long long expansion = CF_DEFAULT_EXPANSION;
36     int ex_loc = RMUtil_ArgIndex("EXPANSION", argv, argc);
37     if (ex_loc != -1) {
38         if (RedisModule_StringToLongLong(argv[ex_loc + 1], &expansion) != REDISMODULE_OK) {
39             return RedisModule_ReplyWithError(ctx, "Couldn't parse EXPANSION");
41             return RedisModule_ReplyWithError(
42                 ctx, "EXPANSION parameter needs to be a non-negative integer");
46     if (bucketSize * 2 > capacity) {