1 static int jpc_dec_process_sod(jpc_dec_t *dec, jpc_ms_t *ms)
3 	jpc_dec_tile_t *tile;
4 	int pos;
6 	JAS_UNUSED(ms);
8 	if (!(tile = dec->curtile)) {
9 		return -1;
12 	if (!tile->partno) {
13 		if (!jpc_dec_cp_isvalid(tile->cp)) {
14 			return -1;
16 		if (jpc_dec_cp_prepare(tile->cp)) {
17 			return -1;
19 		if (jpc_dec_tileinit(dec, tile)) {
20 			return -1;
25 	if (dec->pkthdrstreams) {
27 		  tile-part. */
28 		if (!(tile->pkthdrstream = jpc_streamlist_remove(dec->pkthdrstreams, 0))) {
29 			return -1;
33 	if (tile->pptstab) {
34 		if (!tile->pkthdrstream) {
35 			if (!(tile->pkthdrstream = jas_stream_memopen(0, 0))) {
36 				return -1;
39 		pos = jas_stream_tell(tile->pkthdrstream);
40 		jas_stream_seek(tile->pkthdrstream, 0, SEEK_END);
41 		if (jpc_pptstabwrite(tile->pkthdrstream, tile->pptstab)) {
42 			return -1;
44 		jas_stream_seek(tile->pkthdrstream, pos, SEEK_SET);
45 		jpc_ppxstab_destroy(tile->pptstab);
46 		tile->pptstab = 0;
49 	if (jas_get_debug_level() >= 10) {
50 		jpc_dec_dump(dec);
53 	if (jpc_dec_decodepkts(dec, (tile->pkthdrstream) ? tile->pkthdrstream :
54 	  dec->in, dec->in)) {
55 		jas_logerrorf("jpc_dec_decodepkts failed\n");
56 		return -1;
60 	if (dec->curtileendoff > 0) {
61 		long curoff;
62 		uint_fast32_t n;
63 		curoff = jas_stream_getrwcount(dec->in);