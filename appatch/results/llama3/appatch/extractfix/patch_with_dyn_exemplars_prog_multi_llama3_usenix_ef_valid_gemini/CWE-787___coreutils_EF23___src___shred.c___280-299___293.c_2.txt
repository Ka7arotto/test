
<   for (i = 3; i < size / 2; i *= 2)
<       memcpy (r + i, r, i);
---
>   for (i = 3; i < size / 2; i *= 2)
>   {
>       size_t remaining = size - i;
>       if (i > remaining)
>       {
>           break;
>       }
>       memcpy (r + i, r, i);
>   }
