c
<         int es = samplesperpixel - nc;
---
>         int es = samplesperpixel - nc;
>         if (es > tf_bytesperrow - (cp - tf_buf)) {
>             // Handle error or exit loop
>         }
