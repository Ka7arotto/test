c
<         cp += es;
---
>         if (cp + es <= tf_buf + tf_bytesperrow) {
>             cp += es;
>         } else {
>             // Handle error or exit loop
>         }
