c
< 	rows[nrows++] = br + bpr*sy;
---
> 	if (nrows < tnh) {
> 		rows[nrows++] = br + bpr*sy;
> 	} else {
> 		// Handle error or exit loop
> 	}
