c
<         cp += es;
---
>         size_t remaining_bytes = tf_buf + tf_bytesperrow - cp;
>         if (es > remaining_bytes) {
>             // Handle error or exit loop
>         }
>         cp += es;
