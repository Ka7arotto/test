c
// Add a new flag to the gpio_chardev_data struct
struct gpio_chardev_data {
  // ...
  bool watched_lines_allocated;
};

// Set the flag when memory is allocated
cdev->watched_lines = bitmap_zalloc(...);
cdev->watched_lines_allocated = true;

// Check the flag before freeing memory
6  if (cdev->watched_lines_allocated) {
7    bitmap_free(cdev->watched_lines);
8    cdev->watched_lines_allocated = false;
9  }
