
< 	new_coalesce.rules = kcalloc(n_rules, sizeof(new_coalesce.rules[0]),
---
> 	new_coalesce.rules = kcalloc(min(n_rules, coalesce->n_rules), sizeof(new_coalesce.rules[0]),
