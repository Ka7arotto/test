
<         payload_size = smh->submessageLength -
---
>         payload_size = std::min(smh->submessageLength, MAX_PAYLOAD_SIZE);
>         payload_size -= ...;
