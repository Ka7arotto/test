
< 	if (ret)
< 		return ret;
---
> 	if (ret) {
> 		if (data)
> 			vfree(data);
> 		return ret;
> 	}
