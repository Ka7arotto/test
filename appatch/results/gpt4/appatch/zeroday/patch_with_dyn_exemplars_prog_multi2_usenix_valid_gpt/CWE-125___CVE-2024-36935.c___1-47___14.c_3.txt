diff
< 	cmd_buf = memdup_user(buf, count);
---
> 	size_t i;
> 	for (i = 0; i < count; i++) {
> 		if (get_user(user_val[i], &buf[i]))
> 			return -EFAULT;
> 	}
> 	cmd_buf = kmemdup(user_val, count, GFP_KERNEL);
