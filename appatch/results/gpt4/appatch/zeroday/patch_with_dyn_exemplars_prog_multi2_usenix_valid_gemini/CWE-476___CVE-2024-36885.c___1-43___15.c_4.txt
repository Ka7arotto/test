diff
10    switch (fw->func->type) {
+11       if (!fw->func)
+12           return -EINVAL;
12        fw->img = kmemdup(src, fw->len, GFP_KERNEL);
+13       if (!fw->img)
+14           return -ENOMEM;
15        len = ALIGN(fw->len, PAGE_SIZE);
