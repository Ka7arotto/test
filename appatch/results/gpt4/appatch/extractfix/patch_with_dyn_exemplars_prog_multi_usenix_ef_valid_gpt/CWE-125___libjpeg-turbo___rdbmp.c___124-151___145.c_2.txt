diff
22     *outptr++ = colormap[0][t]; /* colormap[x] has size cmaplen */
---
22     t = (t < 0) ? 0 : (t >= cmaplen ? cmaplen - 1 : t);
22     *outptr++ = colormap[0][t];
