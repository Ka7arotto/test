c
// Introduce a delayed free queue
struct qeth_card {
    ...
    struct queue *delayed_free_queues;
    ...
};

// Implement delayed freeing
8  if (atomic_read(&card->qdio.state) != QETH_QDIO_UNINITIALIZED) {
9      mark_queues_for_delayed_free(card);
10     schedule_delayed_free(card);
11 }
12 card->qdio.no_out_queues = max;
