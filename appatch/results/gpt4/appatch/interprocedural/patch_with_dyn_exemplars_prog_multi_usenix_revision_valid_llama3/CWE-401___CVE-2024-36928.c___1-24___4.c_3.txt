c
#include <stdatomic.h>

// Change no_out_queues to atomic variable
struct qeth_qdio {
    atomic_int no_out_queues;
    ...
};

// Update using atomic store
5  if (atomic_load(&card->qdio.no_out_queues) == max)
6      return;
7  atomic_store(&card->qdio.no_out_queues, max);
8  if (atomic_read(&card->qdio.state) != QETH_QDIO_UNINITIALIZED)
9      qeth_free_qdio_queues(card);
