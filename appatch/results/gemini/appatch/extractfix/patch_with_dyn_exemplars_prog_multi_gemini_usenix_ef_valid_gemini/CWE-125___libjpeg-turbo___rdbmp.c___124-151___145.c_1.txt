c++
for (col = cinfo->image_width; col > 0; col--) {
    t = GETJSAMPLE(*inptr++);
    t = (t < cmaplen) ? t : (cmaplen - 1); // Clamp to maximum index
    *outptr++ = colormap[0][t];
}
