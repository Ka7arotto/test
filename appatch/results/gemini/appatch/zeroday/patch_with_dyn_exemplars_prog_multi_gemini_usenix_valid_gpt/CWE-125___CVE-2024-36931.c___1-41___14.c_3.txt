c
   buffer = kmalloc(lbuf, GFP_KERNEL); // Allocate kernel buffer
   if (!buffer) {
       return -ENOMEM;
   }

   if (copy_from_user(buffer, buf, lbuf) != 0) {
       kfree(buffer);
       return -EFAULT;
   }
   