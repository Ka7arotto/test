void kgd2kfd_suspend ( struct kfd_dev * kfd , bool run_pm ) { struct kfd_node * node ; int i ; int count ; if ( ! kfd -> init_complete ) { return ; } /* for runtime suspend, skip locking kfd */ if ( ! run_pm ) { mutex_lock ( & kfd_processes_mutex ) ; count = ++ kfd_locked ; mutex_unlock ( & kfd_processes_mutex ) ; /* For first KFD device suspend all the KFD processes */ if ( count == 1 ) { kfd_suspend_all_processes ( ) ; } } for ( i = 0 ; i < kfd -> num_nodes ; i ++ ) { node = kfd -> nodes [ i ] ; node -> dqm -> ops . stop ( node -> dqm ) ; } } 